<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form to Table with WhatsApp</title>
    <link href="https://drive.google.com/uc?id=1aSVojikJwvsYVa8oqCTxBAilZRC-3JNL" rel="stylesheet" type="text/css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
            background: #f5f5f5;
        }

        h1, h2 {
            background: linear-gradient(90deg, #FFB300, #FF5722);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 36px;
            margin: 20px 0;
        }

        h1 {
            font-family: 'Timmana', sans-serif;
        }

        h2 {
            font-size: 28px;
        }

        form {
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: inline-block;
        }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        input, button {
            width: 80%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background: #FF5722;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background: #E64A19;
        }

        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }

        th {
            background: #FF5722;
            color: white;
            font-weight: bold;
        }

        td {
            font-size: 14px;
        }

        #donations {
            font-family: 'Timmana', sans-serif;
            font-size: 30px; 
            margin: 10px 0; 
        }

        .watermark {
            position: fixed; 
            bottom: 10px; 
            right: 10px; 
            font-size: 12px; 
            color: #aaa; 
        }

        #totalAmountContainer {
          margin-top: 20px; 
          font-size: 24px; 
          font-weight: bold; 
          color: #FF5722; 
        }
    </style>
</head>
<body>

    <h1>Lady weds Pramod</h1> 
    <div id="donations">Donations (చదివింపులు)</div>

    <h2>Enter Details</h2>

    <form id="detailsForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
        
        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount" required>
        
        <label for="mobile">Mobile Number:</label>
        <input type="tel" id="mobile" name="mobile" pattern="[0-9]{10}" required>
        
        <button type="button" onclick="submitForm()">Submit</button>
        
        <button type="button" id="whatsappButton" style="display:none;" onclick="sendWhatsApp()">Thank through WhatsApp</button>
        
        <button type="button" onclick="exportToCSV()">Export to CSV</button>
    </form>

    <!-- Total Amount Display -->
    <div id="totalAmountContainer">Total Amount: ₹<span id="totalAmount">0.00</span></div>

    <h2>Details Table</h2>

    <table id="detailsTable">
        <thead>
            <tr>
                <th>S.No</th>
                <th>Name</th>
                <th>Amount</th>
                <th>Mobile Number</th>
            </tr>
        </thead>
        <tbody>
          <!-- Entries will be added here -->
        </tbody>
    </table>

    <div class="watermark">This page is made by Pramod Beema</div>

    <script>
      let serialNumber = 1;

      // Load stored data from localStorage when the page is loaded
      window.onload = function() {
          const storedData = localStorage.getItem('tableData');
          if (storedData) {
              const tableData = JSON.parse(storedData);
              tableData.forEach((entry, index) => {
                  addRowToTable(entry.name, entry.amount, entry.mobile, index + 1);
                  serialNumber = index + 2; // Update serial number
              });
              updateTotal(); // Update total on load
          }
      };

      function submitForm() {
          const name = document.getElementById('name').value.trim();
          const amount = parseFloat(document.getElementById('amount').value.trim());
          const mobile = document.getElementById('mobile').value.trim();

          // Validate mobile number length
          if (!/^\d{10}$/.test(mobile)) {
              alert('Please enter a valid 10-digit mobile number.');
              return; 
          }

          if (name && !isNaN(amount) && mobile) {
              if (isDuplicateEntry(name, amount, mobile)) {
                  alert('Duplicate entry detected!');
                  return; 
              }
              addRowToTable(name, amount, mobile, serialNumber);
              saveDataToLocalStorage(name, amount, mobile);
              document.getElementById('whatsappButton').style.display = 'block';
              serialNumber++;
              updateTotal(); // Update total after adding new entry
          } else {
              alert('Please fill out all fields.');
          }
      }

      function isDuplicateEntry(name, amount, mobile) {
          const tableData = JSON.parse(localStorage.getItem('tableData')) || [];
          return tableData.some(entry => entry.name === name && entry.amount === amount && entry.mobile === mobile);
      }

      function addRowToTable(name, amount, mobile, serial) {
          const table = document.getElementById('detailsTable').getElementsByTagName('tbody')[0];
          const newRow = table.insertRow();

          newRow.insertCell(0).innerHTML = serial; 
          newRow.insertCell(1).innerHTML = name; 
          newRow.insertCell(2).innerHTML = amount; 
          newRow.insertCell(3).innerHTML = mobile; 
      }

      function saveDataToLocalStorage(name, amount, mobile) {
          const tableData = localStorage.getItem('tableData');
          let data = tableData ? JSON.parse(tableData) : [];
          data.push({ name, amount, mobile });
          localStorage.setItem('tableData', JSON.stringify(data));
      }

      function updateTotal() {
          const rows = document.querySelectorAll('#detailsTable tbody tr');
          let total = Array.from(rows).reduce((sum, row) => sum + parseFloat(row.cells[2].innerText || '0'), 0);
          document.getElementById('totalAmount').innerText = total.toFixed(2);
      }

      function sendWhatsApp() {
          const name = document.getElementById('name').value; 
          const amount = document.getElementById('amount').value; 
          const mobile = document.getElementById('mobile').value; 
          
          // Updated message format
          const message = `Thank you *${name}* garu for being a kind contributor of \`₹${amount}/-\` on the occasion of *_Lady weds Pramod_*.`; 
          
          const encodedMessage = encodeURIComponent(message); 
          const whatsappUrl = `https://wa.me/91${mobile}?text=${encodedMessage}`; 
          
          window.open(whatsappUrl, '_blank'); 
      }

      function exportToCSV() { 
          const rows = []; 
          const table = document.getElementById("detailsTable"); 

          for (let i = 0; i < table.rows.length; i++) { 
              let rowData = []; 
              for (let j = 0; j < table.rows[i].cells.length; j++) { 
                  rowData.push(table.rows[i].cells[j].innerText); 
              } 
              rows.push(rowData.join(",")); 
          } 

          const csvContent = "data:text/csv;charset=utf-8," + rows.join("\n"); 
          const encodedUri = encodeURI(csvContent); 
          const link = document.createElement("a"); 
          
          link.setAttribute("href", encodedUri); 
          link.setAttribute("download", "donations.csv"); 
          
          document.body.appendChild(link); 
          
          link.click(); 
          
          document.body.removeChild(link); 
      }
    </script>

</body>
</html>
